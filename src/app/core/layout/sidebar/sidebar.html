<!-- Icon Sidebar Root -->
  <div class="sidebar-container position-fixed d-flex flex-column pt-5"
       [class.expanded]="sidebarExpanded"
       [attr.aria-expanded]="sidebarExpanded">
    <button class="sidebar-toggle-btn" type="button"
            (click)="toggleSidebarExpansion()"
            (keydown.enter)="toggleSidebarExpansion()"
            (keydown.space)="toggleSidebarExpansion()"
            aria-label="Toggle primary menu"
            [attr.aria-pressed]="sidebarExpanded">
      <i class="bi" [ngClass]="sidebarExpanded ? 'bi-chevron-left' : 'bi-chevron-right'"></i>
    </button>
    
    @for (panel of sidebarPanels; track panel.title; let i = $index) {
      <div class="d-flex align-items-center icon-btn my-2 flex-column"
           [class.active]="selectedIndex === i"
           [attr.data-bs-toggle]="'tooltip'"
           [attr.title]="panel.title"
           (click)="toggleSidebar(i)">
        <i class="{{ panel.icon }}"></i>
        @if (sidebarExpanded) {
          <p class="text-white">{{ panel.title }}</p>
        }
      </div>
    }
  </div>

  <!-- Slide-out Sidebar -->
  @if (showSidebar) {
    <div class="sidebar-open position-fixed"
         [class.shifted]="sidebarExpanded"
         [class.show]="showSidebar"
         [class.animating-open]="animating && showSidebar"
         [class.animating-close]="animating && !showSidebar"
         (animationend)="onPanelAnimationEnd()">
      <div class="sidebar-header d-flex align-items-center justify-content-between pe-2">
        <h4 class="m-0">{{ sidebarPanels[selectedIndex].title }}</h4>
        <button type="button" class="panel-close-btn" (click)="closeSidebar()" aria-label="Close panel">
          <i class="bi bi-x-lg"></i>
        </button>
      </div>

      <div class="sidebar-content">
        <button class="floating-collapse" type="button" (click)="closeSidebar()" aria-label="Collapse side panel">
          <i class="bi bi-chevron-double-left"></i>
        </button>

  @for (section of sidebarPanels[selectedIndex].sections; track section.name) {
          <div class="section-item mb-3">
            <div class="section-header"
                 [class.expanded]="section.expanded"
                 (click)="toggleSection(section)">
              <span class="section-title">{{ section.name }}</span>
              <i class="bi section-chevron"
                 [ngClass]="section.expanded ? 'bi-chevron-down rotated' : (section.subItems ? 'bi-chevron-right' : '')">
              </i>
            </div>

            @if (section.subItems) {
              <div class="sub-items"
                   [class.expanded]="section.expanded && section.subItems">
                @for (sub of section.subItems; track sub.name) {
                  @if (sub.enabled !== false) {
                    <div class="sub-item"
                         (click)="selectSubItem(sub)"
                         [class.active]="sub.active"
                         attr.data-route="{{sub.route}}">
                      {{ sub.name }}
                    </div>
                  }
                }
              </div>
            }
          </div>
        }
      </div>
    </div>
  }